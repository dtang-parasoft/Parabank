<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Avoid inefficient iteration over Map entries [BD.OPT.INEFMAP]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Avoid inefficient iteration over Map entries [BD.OPT.INEFMAP]
</STRONG>
<p>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>
This rule detects cases of inefficient iteration over map based on iteration over
map's keyset.

The mistake (from a performance point of view) that programmers often make is that
they use keyset to iterate over a map, and then for each key retrieved, they
request a value. This causes a relatively intensive operation of lookup by key in the
map.

The iteration is easily converted into an efficient one by using entryset
instead of key set. Each entry in the entry set contains a key-value pair and
does not require a computation-heavy lookup operation.


</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>
v8.0


</PRE>
<STRONG>
NOTES
</STRONG>
<PRE>
N/A


</PRE>
<STRONG>
SECURITY RELEVANCE
</STRONG>
<PRE>
N/A


</PRE>
<STRONG>
PARAMETERS
</STRONG>
<PRE>
The "Report unvalidated violations" parameter can result in more violations,
but possibly also more false positives, being reported. In this mode Flow 
Analysis will not check whether the path of the violation can be reached from
the beginning of the function. In some complicated cases, restricted analysis
depth may prevent Flow Analysis from completing the violation validation
procedure. If this happens, violation can be found only with this parameter 
turned on.


</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

Enforcing this rule ensures performance is not wasted unnecessarily when
iterating over maps, which is a frequent operation in many applications.


</PRE>
<STRONG>
DRAWBACKS
</STRONG>
<PRE>
N/A


</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>
Here is an example that triggers a violation:

import java.util.Iterator;
import java.util.Map;

public class Example
{
    public void iterate(Map&lt;String, Integer&gt; map)
    {
        Iterator&lt;String&gt; iter = map.keySet().iterator();
        while (iter.hasNext()) {
            String key = iter.next();
            Integer value = map.get(key); // VIOLATION
            // do something with value
        }
    }
}


</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

import java.util.Iterator;
import java.util.Map;

public class Repair
{
    public void iterate(Map&lt;String, Integer&gt; map)
    {
        Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; iter = map.entrySet().iterator();
        while (iter.hasNext()) {
            Map.Entry&lt;String, Integer&gt; entry = iter.next();
            String key = entry.getKey();
            Integer value = entry.getValue(); // NO VIOLATION
            // do something with value
        }
    }
}

</PRE>
</BODY>
</HTML>
