<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Safely serialize sensitive data [OWASP2017.A3.SSSD]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Safely serialize sensitive data [OWASP2017.A3.SSSD]
</STRONG>
<p>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>
This rule detects cases when sensitive objects are serialized before they are signed and sealed.
Sealing an object results in encryption of the serialized data. Signing means that
a digital signature is applied to the object to guarantee object integrity.

The rule checks if the data written into java.io.ObjectOutputStream is signed with
java.security.SignedObject and sealed with javax.crypto.SealedObject.

The sources of sensitive data:

   * toString(): The toString() method is often implemented to display information that is
     internal to an object.

   * Reflection: Reflection allows a program to examine and modify its own structure and
     behavior at runtime. For this reason, objects of the following classes that are used
     in the reflection mechanism are considered sensitive:  
      * java.lang.Class
      * java.reflect.AccessibleObject
      * java.lang.reflect.Field
      * java.lang.reflect.Method
      * java.lang.reflect.Constructor

   * Exceptions: Any instance of java.lang.Throwable is sensitive.

   * Environment variables and system properties
   
Additional sources of sensitive data can be specified - see PARAMETERS section.



</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>
v10.2.3


</PRE>
<STRONG>
SECURITY RELEVANCE
</STRONG>
<PRE>
Serializing unencrypted objects enables an attacker to intercept potentially sensitive
information that could allow unauthorized access to an application.


</PRE>
<STRONG>
PARAMETERS
</STRONG>
<PRE>
The "Consider the Object.toString() method sensitive" parameter allows you to
specify how the rule treats the Object.toString() method. If enabled, the rule
assumes that the method returns sensitive data. This parameter is enabled by
default.

The "Consider environment variables and system properties sensitive" parameter
allows you to specify how the rule treats methods that return environment
variables or system properties (e.g. "System.getProperty(String key)").
If enabled, the rule assumes that such methods return sensitive data.
This parameter is enabled by default.

The "Additional sensitive methods" parameter allows you to specify
additional sensitive methods.
This parameter is empty by default. Fill in the following columns to configure
a method and specify the data it affects.
- "Enabled" - enables or disables the sensitive method. If disabled, the rule
    does not consider the method to be a sensitive method.
- "Fully qualified type name (wildcard)" - specifies the fully qualified name
    of the type that declares the method. You can use "*" for a method declared
    in any type.
- "Method name (wildcard)" - specifies the name of the method.
- "+ definitions in subclasses" - if enabled, the information configured in
    the current row applies to methods with the specified name that are defined
    in subclasses of the given class. Note that this applies to both instance
    and non-instance methods.
- "'this' object is sensitive" - if enabled, the method makes the object it is
    called on sensitive.
- "Returns sensitive data" - if enabled, the method makes its return value sensitive.
- "Sensitive parameters" - specifies which method parameters are made by
    the method. List 1-based indexes of parameters separated by a comma or
    use "*" to specify that all method parameters are affected.


The "Sensitive types" parameter allows you to specify the types
the rule assumes to be sensitive. By default, it includes the types listed in
the DESCRIPTION section.
 

</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>
Enforces secure serialization of potentially sensitive information.



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>
Here is an example of unsafe code:

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;

public class Example
{
    public void doSerialize(Exception e, File f)
        throws IOException
    {
        ObjectOutputStream out = null;
        try {
            out = new ObjectOutputStream(new FileOutputStream(f));
            out.writeObject(e); // VIOLATION
        } finally {
            out.close();
        }
    }
}



</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>
The following code signs and seals object before serializing it:

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.security.GeneralSecurityException;
import java.security.PrivateKey;
import java.security.Signature;
import java.security.SignedObject;

import javax.crypto.Cipher;
import javax.crypto.SealedObject;

public class Repair
{
    public void doSerialize(Exception e, File f, Cipher c, PrivateKey key, Signature signature)
        throws IOException, GeneralSecurityException
    {
        ObjectOutputStream out = null;
        try {
            out = new ObjectOutputStream(new FileOutputStream(f));
            SignedObject signed = new SignedObject(e, key, signature);
            SealedObject sealed = new SealedObject(signed, c);
            out.writeObject(sealed); // NO VIOLATION
        } finally {
            out.close();
        }
    }
}


</PRE>
<STRONG>
EDUCATION AND TRAINING
</STRONG>
<PRE>

Serialization
Video: <A HREF="https://vimeo.com/205101080">https://vimeo.com/205101080</A>
PDF: <A HREF="http://research.cs.wisc.edu/mist/SoftwareSecurityCourse/Chapters/3_5-Serialization.pdf">http://research.cs.wisc.edu/mist/SoftwareSecurityCourse/Chapters/3_5-Serialization.pdf</A>

Additional training about this vulnerability and preventative best practices are available via our educational partner.
Please contact your Parasoft support team for more information how to access these resources.
<A HREF="https://app.hackedu.com/link/fdaf0115-6c8c-410d-97c3-00965dbf3b92">https://app.hackedu.com/link/fdaf0115-6c8c-410d-97c3-00965dbf3b92</A>



</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

OWASP Top 10-2021
A02:2021 - Cryptographic Failures
<A HREF="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">https://owasp.org/Top10/A02_2021-Cryptographic_Failures/</A>

OWASP Top 10 2017 (A3-Sensitive Data Exposure):
<A HREF="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure.html">https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure.html</A>

2022 CWE Top 25 Most Dangerous Software Errors
CWE-502: Deserialization of Untrusted Data
<A HREF="https://cwe.mitre.org/data/definitions/502.html">https://cwe.mitre.org/data/definitions/502.html</A>

SEI CERT Oracle Coding Standard for Java
SER02-J. Sign then seal sensitive objects before sending them outside a trust boundary
<A HREF="https://www.securecoding.cert.org/confluence/display/java/SER02-J.+Sign+then+seal+objects+before+sending+them+outside+a+trust+boundary">https://www.securecoding.cert.org/confluence/display/java/SER02-J.+Sign+then+seal+objects+before+sending+them+outside+a+trust+boundary</A>

DISA Application Security and Development Security Technical Implementation Guide (STIG)
APSC-DV-001460: An application vulnerability assessment must be conducted.

Tags: OWASP, CWE, CERT

</PRE>
</BODY>
</HTML>
