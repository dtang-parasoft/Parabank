<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Remove temporary files before termination [CERT.FIO03.REMTMP]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Remove temporary files before termination [CERT.FIO03.REMTMP]
</STRONG>
<p>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>
This rule detects cases when a temporary file is not or may not be removed
before program termination.

I. Temporary files are the files which have been created with the following methods:

1. java.io.File:
    * static File createTempFile(String prefix, String suffix)
    * static File createTempFile(String prefix, String suffix, File directory)   

2. java.nio.file.Files:
    * static Path createTempFile(Path dir, String prefix, String suffix, 
								 FileAttribute&lt;?&gt;... attrs)
    * static Path createTempFile(String prefix, String suffix, FileAttribute&lt;?&gt;... attrs)	
	
	
II. To make sure that a temporary file will be removed, you can:
  
1.  call the following method on the File object:
    * boolean delete()
			
2. call the following methods with the path to the temporary file as an argument:
    * static void delete(Path path)
    * static boolean deleteIfExists(Path path)
 
3. call the following methods with the path to the temporary file as Path and 
    StandardOpenOption.DELETE_ON_CLOSE as OpenOption:
   				   
   * static BufferedWriter newBufferedWriter(Path path, Charset cs, OpenOption... options)
   * static SeekableByteChannel newByteChannel(Path path, OpenOption... options)
   * static SeekableByteChannel newByteChannel(Path path, Set&lt;? extends OpenOption&gt; options, 
   											   FileAttribute&lt;?&gt;... attrs)
   * static OutputStream newOutputStream(Path path, OpenOption... options)
   * static Path write(Path path, byte[] bytes, OpenOption... options)
   * static Path write(Path path, Iterable&lt;? extends CharSequence&gt; lines, Charset cs, 
   					   OpenOption... options)
    


</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>
v10.2.3



</PRE>
<STRONG>
NOTES
</STRONG>
<PRE>
N/A



</PRE>
<STRONG>
SECURITY RELEVANCE
</STRONG>
<PRE>
Temporary files must be removed before program termination. They consume the resources necessary
to perform actions and may allow an attacker to access sensitive data. Removing temporary files when
they are no longer required allows file names and other resources to be recycled. Each program is
responsible for ensuring that temporary files are removed during normal operation.



</PRE>
<STRONG>
PARAMETERS
</STRONG>
<PRE>
N/A



</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>
Protects against information leakage and resource exhaustion. 



</PRE>
<STRONG>
DRAWBACKS
</STRONG>
<PRE>
N/A



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>
Here is an example of unsafe code:

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;

public class Example
{
    public static void method()
        throws IOException
    {
        File f = File.createTempFile("tempnam", ".tmp");
        FileOutputStream fop = null;
        try {
            fop = new FileOutputStream(f);
            String str = "Data";
            fop.write(str.getBytes());
            fop.flush();
        } finally {
            if (fop != null) {
                try {
                    fop.close();
                } catch (IOException x) {
                    // Handle error
                }
            }
        }
    } // VIOLATION
}


</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>
The following code will not trigger a violation:

import java.io.BufferedWriter;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.FileAlreadyExistsException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardOpenOption;

public class Repair
{
    public static void method()
    {
        Path tempFile = null;
        try {
            tempFile = Files.createTempFile("tempnam", ".tmp");
            try (BufferedWriter writer = Files.newBufferedWriter(tempFile, Charset.forName("UTF8"), StandardOpenOption.DELETE_ON_CLOSE)) { // NO VIOLATION
                // Write to file
            }
            System.out.println("Temporary file write done, file erased");
        } catch (FileAlreadyExistsException x) {
            System.err.println("File exists: " + tempFile);
        } catch (IOException x) {
            // Some other sort of failure, such as permissions.
            System.err.println("Error creating temporary file: " + x);
        }
    } // NO VIOLATION
}


</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

SEI CERT Oracle Coding Standard for Java
FIO03-J. Remove temporary files before termination 
<A HREF="https://www.securecoding.cert.org/confluence/display/java/FIO03-J.+Remove+temporary+files+before+termination">https://www.securecoding.cert.org/confluence/display/java/FIO03-J.+Remove+temporary+files+before+termination</A>

Java Platform, Standard Edition (Java SE) 8, Class File
<A HREF="https://docs.oracle.com/javase/7/docs/api/java/io/File.html">https://docs.oracle.com/javase/7/docs/api/java/io/File.html</A>

Java Platform, Standard Edition (Java SE) 8, Class Files
<A HREF="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html">https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html</A>

Java Platform, Standard Edition (Java SE) 8, Class Path
<A HREF="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Path.html">https://docs.oracle.com/javase/7/docs/api/java/nio/file/Path.html</A>

Tags: CERT

</PRE>
</BODY>
</HTML>
