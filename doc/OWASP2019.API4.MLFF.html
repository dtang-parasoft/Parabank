<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Specify a valid 'maxlength' value for each form field in Struts validation files [OWASP2019.API4.MLFF]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Specify a valid 'maxlength' value for each form field in Struts validation files [OWASP2019.API4.MLFF]
</STRONG>
<p>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>

This rule checks that a valid "maxlength" value is specified for each '&lt;field&gt;'
element in a 'validation.xml' or 'validation-rules.xml' file.  The rule will 
flag a violation for any of the following errors in one of these files:

    1) A '&lt;field&gt;' element is missing a "maxlength" validator.
    2) The '&lt;var-value&gt;' element for the "maxlength" validator is empty or 
       contains no text other than whitespace characters.
    3) The value specified for the "maxlength" validator is negative or zero.
    4) The value specified for the "maxlength" validator is not a valid integer.

The rule will flag a violation for each occurrence of one of the four problems
listed above.


</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>

v8.4


</PRE>
<STRONG>
SECURITY RELEVANCE
</STRONG>
<PRE>

category: Unsafe Environment Configuration

If fields are not validated for a maximum length, it is much easier for 
attackers to perform Denial of Service or injection attacks.  We recommend 
specifying a maximum length for each field using the Struts "maxlength" 
validator.  Doing so will help to protect against attacks.


</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

This sample 'validation.xml' file shows six different errors relating to missing
or invalid "maxlength" validators that will be caught by this rule.

validation.xml:

&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name="ColorForm" &gt;
      &lt;field property="shape" depends="required"&gt;  &lt;!-- VIOLATION: no "maxlength" validator --&gt;
      &lt;/field&gt;
      &lt;field property="color" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value/&gt;  &lt;!-- VIOLATION: empty '&lt;var-value&gt;' element --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="hue" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;-5&lt;/var-value&gt;  &lt;!-- VIOLATION: The "maxlength" must be a positive integer --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="foo" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;0&lt;/var-value&gt;  &lt;!-- VIOLATION: The "maxlength" cannot be zero. --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="bar" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;abba&lt;/var-value&gt;  &lt;!-- VIOLATION: The "maxlength" must be an integer. --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="baz" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;   		  &lt;/var-value&gt;  &lt;!-- VIOLATION: empty '&lt;var-value&gt;' element --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
    &lt;/form&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;


</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

Ensure that each '&lt;field&gt;' element in the 'validation.xml' file has a "maxlength"
validator and that a valid positive integer value is specified in the 
'&lt;var-value&gt;' element for the "maxlength" of each field.  Here we used 10 for 
the maximum length of each field, but you should choose an appropriate maximum
length for each field in your application.

validation.xml:
    
&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name="ColorForm" &gt;
      &lt;field property="shape" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;  &lt;!-- FIXED --&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="color" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  &lt;!-- FIXED --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="hue" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  &lt;!-- FIXED --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="foo" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  &lt;!-- FIXED --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="bar" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  &lt;!-- FIXED --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
      &lt;field property="baz" depends="required"&gt;
        &lt;var&gt;
          &lt;var-name&gt;maxlength&lt;/var-name&gt;
          &lt;var-value&gt;10&lt;/var-value&gt;  &lt;!-- FIXED --&gt;
        &lt;/var&gt;
      &lt;/field&gt;
    &lt;/form&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;



</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

1. Cigital Java Security Rule Pack # 52:
   <A HREF="http://www.cigital.com/securitypack/view/index.html">http://www.cigital.com/securitypack/view/index.html</A>

2. Struts 1.3.10 Documentation:
   <A HREF="http://struts.apache.org/release/1.3.x/userGuide/index.html">http://struts.apache.org/release/1.3.x/userGuide/index.html</A>
   <A HREF="http://struts.apache.org/release/1.3.x/faqs/validator.html">http://struts.apache.org/release/1.3.x/faqs/validator.html</A>

3. OWASP API Security Top 10-2019
   API4-Lack of Resources &amp; Rate Limiting
   <A HREF="https://github.com/OWASP/API-Security/blob/v1.4.1/2019/en/src/0xa4-lack-of-resources-and-rate-limiting.md">https://github.com/OWASP/API-Security/blob/v1.4.1/2019/en/src/0xa4-lack-of-resources-and-rate-limiting.md</A>

</PRE>
</BODY>
</HTML>
