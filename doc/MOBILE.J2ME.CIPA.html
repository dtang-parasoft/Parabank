<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Avoid constant initializations of primitive arrays that exceed a certain size [MOBILE.J2ME.CIPA]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Avoid constant initializations of primitive arrays that exceed a certain size [MOBILE.J2ME.CIPA]
</STRONG>
<p>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>

This rule identifies constant initializations of primitive arrays that exceed
a certain size. An error is reported for each occurrence. 

Array initializations appear as individual assignments in the Java
bytecode. If large arrays need to be filled with predefined constants,
this can cause a significant overhead in bytecode size. Beyond a
certain threshold, it is more memory efficient to read the data from
encoded strings or from binary files that are stored as additional
resources in the JAR file.



</PRE>
<STRONG>
SCOPE LEVEL
</STRONG>
<PRE>
LINE



</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>

v5.1



</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

Avoiding large arrays filled with predefined constants reduces the
bytecode size. It also prevents the code from being cluttered with
large arrays of constants.



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

For example, the expression int[] prime = {2, 3, 5, 7, 11}; produces
the following bytecode sequence:

         0:   iconst_5
         1:   newarray int
         3:   dup
         4:   iconst_0
         5:   iconst_2
         6:   iastore
         7:   dup
         8:   iconst_1
         9:   iconst_3
         10:  iastore
         11:  dup
         12:  iconst_2
         13:  iconst_5
         14:  iastore
         15:  dup
         16:  iconst_3
         17:  bipush  7
         19:  iastore
         20:  dup
         21:  iconst_4
         22:  bipush  11
         24:  iastore
         25:  astore_1
        

The initialization uses 4 instructions per value, but, depending on
the particular values, usually more than 4 bytes per value.



</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

Move large constant arrays into binary files and initialize the array
from the content of the file. The threshold value for the individual
primitive data types will differ.


</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

<A HREF="http://developer.android.com/guide/practices/design/performance.html">http://developer.android.com/guide/practices/design/performance.html</A>

Eric Giguere, Optimizing J2ME Application Size,
<A HREF="http://sun.systemnews.com/fullsource?article=6028">http://sun.systemnews.com/fullsource?article=6028</A>

</PRE>
</BODY>
</HTML>
